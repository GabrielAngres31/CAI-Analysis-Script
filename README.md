# CAI-Analysis-Script
The location where files relating to the CAI script and analysis are kept.

There are four subfolders needed for the program to run: **parameters**, **data_files**, **image_output**, and **table_output**

**parameters** contains any list or dataframe which are referenced to generate plot data.
Lists of models to go into individual heatmaps get their own folder, within this compartment.

**data_files** contains all .csv files that are referenced in the analysis.
full_data is an aggregation of `PARL0_06202022.csv`, `Pad_Area_Estimations.csv`, and `dry_weight_proportion_raws`, joined and augmented with some additional measures as necessary for the analysis.

**image_output** holds all of the figure plots generated by this program, organized by folder networks.
**table_output** holds all of the .csv tables generated as output by this program.

The main program file is **data_filtration_augmentation.R**. This file contains all of the functions needed for this program.
You can run these functions individually from the console.

NOTE: Except for the qqPlot function, none of the image-creating functions create any graphical devices OR turn them off.
Please make sure that you use `UTILITY.quickPNG()` and `dev.off()` when using these functions.
Ex.
```
UTILITY.quickPNG(filename, filepath)
# <function(params)>
dev.off()
```


### Quick installation using conda (Linux64)

Download the latest EDTA:

`git clone https://github.com/GabrielAngres31/CAI-Analysis-Script.git`  
`cd CAI-Analysis-Script`

Find the yml file in the folder and run:

`conda env create -f CAI.yml`


The default `conda env` name is `CAI` specified by the first line of the `CAI.yml` file. You may change that to a different name. Once the conda environment is set up, you can use it to drive other versions of CAI. 

First, it is strongly recommended to ceate a dedicated environment for CAI:

```
conda create -n CAI
conda activate CAI
```


## Usage:
```
conda activate CAI
cd Script-v3
Rscript data_filtration_augmentation.R
```

## Required R packages.
IMPORTANT: MAKE SURE THE FOLLOWING LIBRARIES WILL BE INSTALLED WITH `data_filtration_augmentation.R`
```
dplyr
tibble
rsq
car
Rcmdr
hash
multcompView
HyperG
plotly
htmlwidgets
magrittr
tidyr
multiApply
stringr
viridis
RColorBrewer
data.table
```


## Generating publication data and graphs
To run the program with the publication data, run the entire program in R. When this dialogue appears:
`MESSAGE: Would you like to use the default dataset? y/N: `
Type `y` and press `Enter`.
**NOTE:** You should only use this option with an unmodified installation of this repository.

### Specs for arbitrary input files
Input file specs are flexible. Whatever fields you wish to analyze (and pass as parameters in the console when using function from the program), simply write them in a replacement file `required_columns.txt`. You can name this file whatever you want, as long as you change its mention in the program. From there, when you wish to pass a list of parameters (as a .txt file) or a list of aliased parameters or models to generate (as a .csv file), simply write them in a file with any name, then call the file as a function parameter to any function that requires them. The base files included should be used as templates.

**CAUTION**: The main program loop is _not_ meant for any dataset other than the CAI dataset provided. The functions definitions and calls in that main program should be considered as examples for use, and should not be simply substituted and run. If you want to do analysis on your own data, you should remove all function calls and substitute your own as needed. If the program throws an error message when you run it on a custom dataset, please check that all **parameter** files have been written and contain the correct contents for your analyis.

If you have any questions about the program operation not answered by the documentation, you can contact me at gangres@nevada.unr.edu.

## Running from the command line through BASH
**NOTE:** These instructions assume that you have already configured a program flow suitable to your analysis.
In that case, you should invoke `Rscript data_filtration_augmentation.r --datafile <data_file> --params <parameters_folder_path>`.

### Explanation of program output
The **image_output** and **table_output** files contain the results of all graphs and tables generated by the base code, and are the recommended locations for graph and table files generated from custom analyses.
All folders generated as part of the base code are generated for convenience, and are _not_ mandatory parts of the program in name or role.

**image_output** contains all generated **heatmaps**, **intermeasure** correlation plots, **qqplots** that can be used to visually assess normality in differen components of the dataset, **tukeyplots** containing Tukey mean comparisons and their corresponding hypergraphs, and **violin_plots** which show the distributions of each measure in each accession.

**table_output** contains the corresponding tables that the heatmaps in **image_output** are generated from.

### Runtime
The running time for the program is noted at the end of each run of the main program. It should take no more than 6-8 minutes to generate all figures and tables from start to finish (given 8GB RAM and an Intel i7 2.8Ghz processor). Results may vary given installed hardware.
